<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.onetouch.web.sts.dao.StsMapper">

	<!-- 자재입고량 mtrIn =====================================-->
	<!-- 일별 -->
	<select id="mtrInDate" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT 	 DECODE(GROUPING_ID(IN_DATE,MTR_CD),3,'자재입고량 합계',IN_DATE) AS IN_DATE,
		         DECODE(GROUPING_ID(IN_DATE,MTR_CD),1,IN_DATE||'소계',MTR_CD) AS MTR_CD, 
		         COUNT(MTR_CD) AS CNT
		FROM 	 MTR_IN 
		WHERE	 IN_DATE BETWEEN #{startDate} AND #{endDate}
		GROUP BY ROLLUP(IN_DATE , MTR_CD)
		ORDER BY IN_DATE,DECODE(SUBSTR(MTR_CD,0,1),'M',0)
	</select>
	
	<!-- 월별 -->
	<select id="mtrInMonth" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT   DECODE(GROUPING_ID(TO_CHAR(IN_DATE, 'YYYY-MM'),MTR_CD),3,'자재입고량 합계',TO_CHAR(IN_DATE, 'YYYY-MM')) AS IN_DATE,
		         DECODE(GROUPING_ID(TO_CHAR(IN_DATE, 'YYYY-MM'),MTR_CD),1,TO_CHAR(IN_DATE, 'YYYY-MM')||'소계',MTR_CD) AS MTR_CD, 
		         COUNT(MTR_CD) AS CNT
		FROM 	 MTR_IN 
		WHERE 	 TO_CHAR(IN_DATE, 'YYYY-MM') BETWEEN #{startDate} AND #{endDate}
		GROUP BY ROLLUP(TO_CHAR(IN_DATE, 'YYYY-MM'),MTR_CD)
		ORDER BY IN_DATE,DECODE(SUBSTR(MTR_CD,0,1),'M',0)
	</select>
	
	<!-- 연도별 -->
	<select id="mtrInYear" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT   DECODE(GROUPING_ID(TO_CHAR(IN_DATE, 'YYYY'),MTR_CD),3,'자재입고량 합계',TO_CHAR(IN_DATE, 'YYYY')) AS IN_DATE,
		         DECODE(GROUPING_ID(TO_CHAR(IN_DATE, 'YYYY'),MTR_CD),1,TO_CHAR(IN_DATE, 'YYYY')||'소계',MTR_CD) AS MTR_CD, 
		         COUNT(MTR_CD) AS CNT
		FROM 	 MTR_IN 
		WHERE 	 TO_CHAR(IN_DATE, 'YYYY') BETWEEN #{startDate} AND #{endDate}
		GROUP BY ROLLUP(TO_CHAR(IN_DATE, 'YYYY') , MTR_CD)
		ORDER BY IN_DATE,DECODE(SUBSTR(MTR_CD,0,1),'M',0)
	</select>
	
	<!-- 자재별, 일별 -->
	<select id="mtrInMtrD" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT   DECODE(GROUPING_ID(MTR_CD, IN_DATE),3,'자재입고량 합계', MTR_CD) AS MTR_CD,
		         DECODE(GROUPING_ID(MTR_CD, IN_DATE),1,MTR_CD||'소계', IN_DATE) AS IN_DATE,
		         COUNT(*) AS CNT
		FROM 	 MTR_IN 
		WHERE 	 IN_DATE BETWEEN #{startDate} AND #{endDate}
		GROUP BY ROLLUP(MTR_CD,IN_DATE)
		ORDER BY MTR_CD
	</select>
	
	<!-- 자재별, 월별 -->
	<select id="mtrInMtrM" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT   DECODE(GROUPING_ID(MTR_CD, TO_CHAR(IN_DATE, 'YYYY-MM')),3,'자재입고량 합계', MTR_CD) AS MTR_CD,
		         DECODE(GROUPING_ID(MTR_CD, TO_CHAR(IN_DATE, 'YYYY-MM')),1,MTR_CD||'소계', TO_CHAR(IN_DATE, 'YYYY-MM')) AS IN_DATE,
		         COUNT(*) AS CNT
		FROM 	 MTR_IN 
		WHERE 	 TO_CHAR(IN_DATE, 'YYYY-MM') BETWEEN #{startDate} AND #{endDate}
		GROUP BY ROLLUP(MTR_CD,TO_CHAR(IN_DATE, 'YYYY-MM'))
		ORDER BY MTR_CD
	</select>
	
	<!-- 자재별, 연도별 -->
	<select id="mtrInMtrY" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT   DECODE(GROUPING_ID(MTR_CD, TO_CHAR(IN_DATE, 'YYYY')),3,'자재입고량 합계', MTR_CD) AS MTR_CD,
		         DECODE(GROUPING_ID(MTR_CD, TO_CHAR(IN_DATE, 'YYYY')),1,MTR_CD||'소계', TO_CHAR(IN_DATE, 'YYYY')) AS IN_DATE,
		         COUNT(*) AS CNT
		FROM 	 MTR_IN 
		WHERE 	 TO_CHAR(IN_DATE, 'YYYY') BETWEEN #{startDate} AND #{endDate}
		GROUP BY ROLLUP(MTR_CD,TO_CHAR(IN_DATE, 'YYYY'))
		ORDER BY MTR_CD
	</select>
	
	<!-- 자재출고량 mtrOut =====================================-->
	<!-- 일별 -->
	<select id="mtrOutDate" resultType="com.onetouch.web.sts.dao.StsVO"></select>
	<!-- 월별 -->
	<select id="mtrOutMonth" resultType="com.onetouch.web.sts.dao.StsVO"></select>
	<!-- 연도별 -->
	<select id="mtrOutYear" resultType="com.onetouch.web.sts.dao.StsVO"></select>
	<!-- 자재별, 일별 -->
	<select id="mtrOutD" resultType="com.onetouch.web.sts.dao.StsVO"></select>
	<!-- 자재별, 월별 -->
	<select id="mtrOutM" resultType="com.onetouch.web.sts.dao.StsVO"></select>
	<!-- 자재별, 연도별 -->
	<select id="mtrOutY" resultType="com.onetouch.web.sts.dao.StsVO"></select>
	
	<!-- 제품생산량 pdtCnt =====================================-->
	<!-- 일별 -->
	<select id="pdtDate" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT   DECODE(GROUPING_ID(work_fin_dt,prd_cd),3,'제품생산량 합계',work_fin_dt) as work_fin_dt,  
		         DECODE(GROUPING_ID(work_fin_dt,prd_cd),1,work_fin_dt||'소계',prd_cd) as prd_cd, 
		         sum(pdt_cnt) as cnt
		FROM     (select a.instr_no, a.work_fin_dt, min(a.pdt_cnt) as pdt_cnt, sum(a.flt_cnt) as flt_cnt, b.prd_cd
		         from prd_prc_mng a, pdt_work_instr_dtl b
		         where a.instr_no = b.instr_no
		         and a.line_no = b.line_no
		         and a.prc_cd = b.prc_cd
		         group by a.instr_no, a.work_fin_dt, b.prd_cd)
		WHERE 	 work_fin_dt between #{startDate} AND #{endDate}
		GROUP BY ROLLUP(work_fin_dt, prd_cd)
		ORDER BY work_fin_dt ,DECODE(SUBSTR(prd_cd,0,1),'P',0)
	</select>
	<!-- 월별 -->
	<select id="pdtMonth" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT   DECODE(GROUPING_ID(TO_CHAR(work_fin_dt, 'YYYY-MM'),prd_cd),3,'제품생산량 합계',TO_CHAR(work_fin_dt, 'YYYY-MM')) AS work_fin_dt,
		         DECODE(GROUPING_ID(TO_CHAR(work_fin_dt, 'YYYY-MM'),prd_cd),1,TO_CHAR(work_fin_dt, 'YYYY-MM')||'소계',prd_cd) AS prd_cd, 
		         sum(pdt_cnt) as cnt
		FROM     (select a.instr_no, a.work_fin_dt, min(a.pdt_cnt) as pdt_cnt, sum(a.flt_cnt) as flt_cnt, b.prd_cd
		         from prd_prc_mng a, pdt_work_instr_dtl b
		         where a.instr_no = b.instr_no
		         and a.line_no = b.line_no
		         and a.prc_cd = b.prc_cd
		         group by a.instr_no, a.work_fin_dt, b.prd_cd)
		WHERE 	 TO_CHAR(work_fin_dt, 'YYYY-MM') between #{startDate} AND #{endDate}
		GROUP BY ROLLUP(TO_CHAR(work_fin_dt, 'YYYY-MM'), prd_cd)
		ORDER BY work_fin_dt ,DECODE(SUBSTR(prd_cd,0,1),'P',0)
	</select>
	<!-- 연도별 -->
	<select id="pdtYear" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT   DECODE(GROUPING_ID(TO_CHAR(work_fin_dt, 'YYYY'),prd_cd),3,'제품생산량 합계',TO_CHAR(work_fin_dt, 'YYYY')) AS work_fin_dt,
		         DECODE(GROUPING_ID(TO_CHAR(work_fin_dt, 'YYYY'),prd_cd),1,TO_CHAR(work_fin_dt, 'YYYY')||'소계',prd_cd) AS prd_cd, 
		         sum(pdt_cnt) as cnt
		FROM     (select a.instr_no, a.work_fin_dt, min(a.pdt_cnt) as pdt_cnt, sum(a.flt_cnt) as flt_cnt, b.prd_cd
		         from prd_prc_mng a, pdt_work_instr_dtl b
		         where a.instr_no = b.instr_no
		         and a.line_no = b.line_no
		         and a.prc_cd = b.prc_cd
		         group by a.instr_no, a.work_fin_dt, b.prd_cd)
		WHERE 	 TO_CHAR(work_fin_dt, 'YYYY') between #{startDate} AND #{endDate}
		GROUP BY ROLLUP(TO_CHAR(work_fin_dt, 'YYYY'), prd_cd)
		ORDER BY work_fin_dt ,DECODE(SUBSTR(prd_cd,0,1),'P',0)
	</select>
	<!-- 제품별, 일별 -->
	<select id="pdtPrdD" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT   DECODE(GROUPING_ID(prd_cd, work_fin_dt),3,'제품생산량 합계', prd_cd) AS prd_cd,
		         DECODE(GROUPING_ID(prd_cd, work_fin_dt),1,prd_cd||'소계', work_fin_dt) AS work_fin_dt,
		         sum(pdt_cnt) as cnt
		FROM     (select a.instr_no, a.work_fin_dt, min(a.pdt_cnt) as pdt_cnt, sum(a.flt_cnt) as flt_cnt, b.prd_cd
		         from prd_prc_mng a, pdt_work_instr_dtl b
		         where a.instr_no = b.instr_no
		         and a.line_no = b.line_no
		         and a.prc_cd = b.prc_cd
		         group by a.instr_no, a.work_fin_dt, b.prd_cd)
		WHERE 	 work_fin_dt between #{startDate} AND #{endDate}
		GROUP BY ROLLUP(prd_cd, work_fin_dt)
		ORDER BY prd_cd
	</select>
	<!-- 제품별, 월별 -->
	<select id="pdtPrdM" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT   DECODE(GROUPING_ID(prd_cd, TO_CHAR(work_fin_dt, 'YYYY-MM')),3,'제품생산량 합계', prd_cd) AS prd_cd,
		         DECODE(GROUPING_ID(prd_cd, TO_CHAR(work_fin_dt, 'YYYY-MM')),1,prd_cd||'소계', TO_CHAR(work_fin_dt, 'YYYY-MM')) AS work_fin_dt,
		         sum(pdt_cnt) as cnt
		FROM     (select a.instr_no, a.work_fin_dt, min(a.pdt_cnt) as pdt_cnt, sum(a.flt_cnt) as flt_cnt, b.prd_cd
		         from prd_prc_mng a, pdt_work_instr_dtl b
		         where a.instr_no = b.instr_no
		         and a.line_no = b.line_no
		         and a.prc_cd = b.prc_cd
		         group by a.instr_no, a.work_fin_dt, b.prd_cd)
		WHERE 	 TO_CHAR(work_fin_dt, 'YYYY-MM') between #{startDate} AND #{endDate}
		GROUP BY ROLLUP(prd_cd, TO_CHAR(work_fin_dt, 'YYYY-MM'))
		ORDER BY prd_cd
	</select>
	<!-- 제품별, 연도별 -->
	<select id="pdtPrdY" resultType="com.onetouch.web.sts.dao.StsVO">
		SELECT  DECODE(GROUPING_ID(prd_cd, TO_CHAR(work_fin_dt, 'YYYY')),3,'제품생산량 합계', prd_cd) AS prd_cd,
		        DECODE(GROUPING_ID(prd_cd, TO_CHAR(work_fin_dt, 'YYYY')),1,prd_cd||'소계', TO_CHAR(work_fin_dt, 'YYYY')) AS work_fin_dt,
		        sum(pdt_cnt) as cnt
		FROM    (select a.instr_no, a.work_fin_dt, min(a.pdt_cnt) as pdt_cnt, sum(a.flt_cnt) as flt_cnt, b.prd_cd
		        from prd_prc_mng a, pdt_work_instr_dtl b
		        where a.instr_no = b.instr_no
		        and a.line_no = b.line_no
		        and a.prc_cd = b.prc_cd
		        group by a.instr_no, a.work_fin_dt, b.prd_cd)
		WHERE TO_CHAR(work_fin_dt, 'YYYY') between #{startDate} AND #{endDate}
		GROUP BY ROLLUP(prd_cd, TO_CHAR(work_fin_dt, 'YYYY'))
		ORDER BY prd_cd
	</select>
	
	<!-- 제품불량량 fltCnt =====================================-->
	<select id="fltDate" resultType="com.onetouch.web.sts.dao.StsVO">
	</select>
	<!-- 월별 -->
	<select id="fltMonth" resultType="com.onetouch.web.sts.dao.StsVO">
	</select>
	<!-- 연도별 -->
	<select id="fltYear" resultType="com.onetouch.web.sts.dao.StsVO">
	</select>
	<!-- 제품별, 일별 -->
	<select id="fltPrdD" resultType="com.onetouch.web.sts.dao.StsVO"></select>
	<!-- 제품별, 월별 -->
	<select id="fltPrdM" resultType="com.onetouch.web.sts.dao.StsVO"></select>
	<!-- 제품별, 연도별 -->
	<select id="fltPrdY" resultType="com.onetouch.web.sts.dao.StsVO"></select>
	
</mapper>