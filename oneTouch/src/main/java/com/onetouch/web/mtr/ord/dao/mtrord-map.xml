<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.onetouch.web.mtr.ord.dao.OrdMapper">
	<select id="select" resultType="com.onetouch.web.mtr.ord.dao.MtrOrdVO">
		SELECT 
			ORD_NO,
			ORD_DATE,
			DLV_REQ_DATE,
			FN_GET_BAS_DTL_CD_TO_NM(#{compCd}) AS COMP_NM,
			FN_GET_MTR_CD_TO_NM(#{mtrCd}) AS MTR_CD,
			UNIT,
			UNIT_COST,
			ORD_AMT,
			IN_AMT,
			NOTIN_AMT,
			CMT
		FROM MTR_ORD
		WHERE 1=1 
		<if test="compCd != null and compCd != ''"> 
			<![CDATA[AND COMP_CD = #{compCd}]]>
		</if>
		<if test="mtrCd != null and mtrCd != ''"> 
			<![CDATA[AND MTR_CD = #{mtrCd}]]>
		</if>
		<if test="startDate != null and startDate != ''"> 
			<![CDATA[AND TO_CHAR(A.IN_DATE, 'yyyy-MM-dd') >= #{startDate}]]>
		</if>
		<if test="endDate != null and endDate != ''"> 
			<![CDATA[AND TO_CHAR(A.IN_DATE, 'yyyy-MM-dd') <= #{endDate}]]>
		</if>
		<if test="compCd != null and compCd != ''">
			AND B.COMP_CD = #{compCd}
		</if>
		<if test="ditemCode != null and ditemCode != ''">
			AND B.MTR_CD = #{ditemCode}
		</if>
	</select>
		<!-- SELECT * 
		FROM MTR_IN A LEFT JOIN ADM_MTR B 
		ON A.MTR_CD = B.MTR_CD -->
	<insert id="insert">
		INSERT INTO MTR_IN 
		(IN_NO,
		MTR_CD,
		IN_DATE,
		ORD_NO,
		UNIT,
		IN_AMT,
		FLT_AMT,
		UNIT_COST,
		TOT_COST
		)
		VALUES(
		FN_MAKE_CODE_COL2('MIN', 'MTR_IN', 'IN_NO', 'IN_DATE'),
		#{mtrCd},
		SYSDATE,
		#{ordNo},
		#{unit},
		#{inAmt},
		#{fltAmt},
		#{unitCost},
		(#{unitCost}*#{inAmt})
		)
	</insert>
	<update id="update">
		UPDATE MTR_IN
		SET
		MTR_CD = #{mtrCd},
		UNIT = #{unit},
		IN_AMT = #{inAmt},
		FLT_AMT = #{fltAmt},
		UNIT_COST = #{unitCost},
		TOT_COST = (#{unitCost}*#{inAmt})
		WHERE
		IN_NO = #{inNo}
	</update>
	<!-- 하나씩 삭제 -->
	<delete id="delete">
		DELETE 
		FROM MTR_IN
		WHERE IN_NO = #{inNo}
	</delete>
	<update id="prdNeed">
		update mtr_in
		set 
		HLD_CNT = #{hldCnt},
		STCK_CNT = STCK_CNT-#{hldCnt}
		WHERE 
		MTR_LOT = #{mtrLot}
	</update>
	<!-- 자재출고테이블 지시때 출고처리해야댐 -->
	<!-- 지시때 lot재고에도 반영해야댐 -->
	<insert id="prdOut">
		<!-- hldCnt: "3"
instrCnt: "3"
mtrCd: "MF001"
mtrLot: "MLT2022010061"
needCnt: "100"
planNo: "PPL202201110001"
prdCd: "prd_001"
stckCnt: "1" -->
	</insert>

	<!-- 리스트로받아서 for문으로 다 삭제하는쿼리 -->
	<!-- <delete id="delete">
		DELETE 
		FROM MTR_IN
		WHERE IN_NO IN
		<foreach collection="list" item="vo" open="(" close=")" separator=",">
		#{vo.inNo}
	</foreach>
	</delete> -->
</mapper>